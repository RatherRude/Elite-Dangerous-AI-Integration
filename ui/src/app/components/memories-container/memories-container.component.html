<div class="memories-log">
  <!-- Logbook Controls -->
  <div class="logbook-controls">
    <div class="date-picker-container">
      <input type="date" class="date-input" [value]="selectedDate | date:'yyyy-MM-dd'" (change)="onDateChange($event)">
      <button class="calendar-icon-btn" (click)="openCalendar()" title="Select date">
        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect>
          <line x1="16" y1="2" x2="16" y2="6"></line>
          <line x1="8" y1="2" x2="8" y2="6"></line>
          <line x1="3" y1="10" x2="21" y2="10"></line>
        </svg>
      </button>
    </div>
    
    <div class="logbook-search">
      <input 
        type="text" 
        class="question-input" 
        placeholder="Ask a question about the logbook..." 
        [(ngModel)]="logbookQuestion"
        (keyup.enter)="askLogbookQuestion()">
      <button class="search-btn" (click)="askLogbookQuestion()" title="Search logbook">
        <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <circle cx="11" cy="11" r="8"></circle>
          <line x1="21" y1="21" x2="16.65" y2="16.65"></line>
        </svg>
      </button>
    </div>
    
    <button class="load-entries-btn" (click)="loadOldEntries()">
      Load Old Entries
    </button>
  </div>

  <!-- Search Results Section -->
  @if (isSearching || searchResults.length > 0) {
    <div class="search-results-container">
      <div class="search-results-header">
        <h3>Search Results ({{ searchResults.length }})</h3>
        <button class="toggle-btn" (click)="toggleSearchResults()" [title]="showSearchResults ? 'Hide results' : 'Show results'">
          @if (showSearchResults) {
            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <polyline points="18 15 12 9 6 15"></polyline>
            </svg>
          } @else {
            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <polyline points="6 9 12 15 18 9"></polyline>
            </svg>
          }
        </button>
      </div>
      
      @if (isSearching) {
        <div class="searching">Searching memories...</div>
      }
      
      @if (showSearchResults && searchResults.length > 0) {
        <div class="search-results">
          @for (result of searchResults; track result.summary) {
            <div class="search-result">
              <div class="result-score">Score: {{ result.score }}</div>
              <div class="result-summary">{{ result.summary }}</div>
            </div>
          }
        </div>
      }
      
      @if (!isSearching && searchResults.length === 0) {
        <div class="no-results">No results found.</div>
      }
    </div>
  }

  <!-- Loaded Old Entries Section -->
  @if (isLoadingEntries) {
    <div class="loading-entries">Loading entries...</div>
  }
  
  @if (filteredEntries.length > 0) {
    <div class="old-entries-container">
      <div class="old-entries-header">
        <h3>Entries for {{ selectedDate | date:'yyyy-MM-dd' }} ({{ filteredEntries.length }})</h3>
      </div>
      <div class="old-entries">
        @for (entry of filteredEntries; track entry.id) {
          <div class="old-entry">
            <span class="entry-time">{{ entry.inserted_at | date:'HH:mm:ss' }}</span>
            <span class="entry-content">{{ entry.content }}</span>
          </div>
        }
      </div>
    </div>
  }

  <!-- Entries Display -->
  @if (memories.length === 0) {
    <div class="empty">No logbook entries recorded yet.</div>
  } @else {
    <div class="entries">
      @for (m of memories; track m.timestamp) {
        <div class="entry">
          <span class="timestamp">{{ m.timestamp | date:'HH:mm:ss' }}</span>
          <span class="message">{{ m.content }}</span>
        </div>
      }
    </div>
  }
</div>


