
<div class="settings-grid">
    @if (config) {
        <p>This section allows you to customize advanced settings. It is recommended to leave these settings
            at their default values unless you know what you are doing.</p>
        <h3>LLM Settings</h3>
        <mat-form-field>
            <mat-label>LLM Provider</mat-label>
            <mat-select [(ngModel)]="config.llm_provider"
                        (ngModelChange)="onConfigChange({llm_provider: $event})">
                <mat-option value="openai">OpenAI</mat-option>
                <mat-option value="openrouter">OpenRouter</mat-option>
                <mat-option value="google-ai-studio">Google AI Studio</mat-option>
                <mat-option value="local-ai-server">Local AIServer</mat-option>
                <mat-option value="custom">Custom</mat-option>
            </mat-select>
        </mat-form-field>
        @if (config.llm_provider === "openai")
        {
            <mat-form-field>
                <mat-label>LLM Model Name</mat-label>
                <input matInput [(ngModel)]="config.llm_model_name"
                        (ngModelChange)="onConfigChange({llm_model_name: $event})">
            </mat-form-field>

            <mat-form-field>
                <mat-label>LLM Temperature</mat-label>
                <input matInput type="number" [(ngModel)]="config.llm_temperature"
                        (ngModelChange)="onConfigChange({llm_temperature: $event})" min="0" max="2" step="0.01">
            </mat-form-field>

            <mat-form-field>
                <mat-label>Override LLM API Key</mat-label>
                <input matInput type="password" [(ngModel)]="config.llm_api_key"
                        (ngModelChange)="onConfigChange({llm_api_key: $event})">
            </mat-form-field>
        }
        @if (config.llm_provider === "openrouter")
        {
            <mat-form-field>
                <mat-label>LLM Model Name</mat-label>
                <input matInput [(ngModel)]="config.llm_model_name"
                        (ngModelChange)="onConfigChange({llm_model_name: $event})">
            </mat-form-field>
            
            <mat-form-field>
                <mat-label>LLM Temperature</mat-label>
                <input matInput type="number" [(ngModel)]="config.llm_temperature"
                        (ngModelChange)="onConfigChange({llm_temperature: $event})" min="0" max="2" step="0.01">
            </mat-form-field>

            <mat-form-field>
                <mat-label>Override LLM API Key</mat-label>
                <input matInput type="password" [(ngModel)]="config.llm_api_key"
                        (ngModelChange)="onConfigChange({llm_api_key: $event})">
            </mat-form-field>

            <label>
                <mat-slide-toggle [(ngModel)]="config.tools_var"
                                    (ngModelChange)="onConfigChange({tools_var: $event})">
                    Allow Actions (Tool Use)
                </mat-slide-toggle>
            </label>
        }
        @if (config.llm_provider === "google-ai-studio")
        {
            <mat-form-field>
                <mat-label>LLM Model Name</mat-label>
                <input matInput [(ngModel)]="config.llm_model_name"
                        (ngModelChange)="onConfigChange({llm_model_name: $event})">
            </mat-form-field>
            
            <mat-form-field>
                <mat-label>LLM Temperature</mat-label>
                <input matInput type="number" [(ngModel)]="config.llm_temperature"
                        (ngModelChange)="onConfigChange({llm_temperature: $event})" min="0" max="2" step="0.01">
            </mat-form-field>

            <mat-form-field>
                <mat-label>Override LLM API Key</mat-label>
                <input matInput type="password" [(ngModel)]="config.llm_api_key"
                        (ngModelChange)="onConfigChange({llm_api_key: $event})">
            </mat-form-field>
        }
        @if (config.llm_provider === "local-ai-server")
        {
            <mat-form-field>
                <mat-label>LLM Endpoint</mat-label>
                <input matInput [(ngModel)]="config.llm_endpoint"
                        (ngModelChange)="onConfigChange({llm_endpoint: $event})">
            </mat-form-field>
            
            <mat-form-field>
                <mat-label>LLM Temperature</mat-label>
                <input matInput type="number" [(ngModel)]="config.llm_temperature"
                        (ngModelChange)="onConfigChange({llm_temperature: $event})" min="0" max="2" step="0.01">
            </mat-form-field>

            <label>
                <mat-slide-toggle [(ngModel)]="config.tools_var"
                                    (ngModelChange)="onConfigChange({tools_var: $event})">
                    Allow Actions (Tool Use)
                </mat-slide-toggle>
            </label>
        }
        @if (config.llm_provider === "custom")
        {

            <mat-form-field>
                <mat-label>LLM Endpoint</mat-label>
                <input matInput [(ngModel)]="config.llm_endpoint"
                        (ngModelChange)="onConfigChange({llm_endpoint: $event})">
            </mat-form-field>

            <mat-form-field>
                <mat-label>LLM Model Name</mat-label>
                <input matInput [(ngModel)]="config.llm_model_name"
                        (ngModelChange)="onConfigChange({llm_model_name: $event})">
            </mat-form-field>
            
            <mat-form-field>
                <mat-label>LLM Temperature</mat-label>
                <input matInput type="number" [(ngModel)]="config.llm_temperature"
                        (ngModelChange)="onConfigChange({llm_temperature: $event})" min="0" max="2" step="0.01">
            </mat-form-field>

            <mat-form-field>
                <mat-label>Override LLM API Key</mat-label>
                <input matInput type="password" [(ngModel)]="config.llm_api_key"
                        (ngModelChange)="onConfigChange({llm_api_key: $event})">
            </mat-form-field>


            <label>
                <mat-slide-toggle [(ngModel)]="config.tools_var"
                                    (ngModelChange)="onConfigChange({tools_var: $event})">
                    Allow Actions (Tool Use)
                </mat-slide-toggle>
            </label>
        }
        

        <hr>
        <h3>STT Settings</h3>
        <mat-form-field>
            <mat-label>STT Provider</mat-label>
            <mat-select [(ngModel)]="config.stt_provider"
                        (ngModelChange)="onConfigChange({stt_provider: $event})">
                <mat-option value="openai">OpenAI</mat-option>
                <mat-option value="google-ai-studio">Google AI Studio (Multi-Modal)</mat-option>
                <mat-option value="local-ai-server">Local AIServer</mat-option>
                <mat-option value="custom">Custom</mat-option>
                <mat-option value="custom-multi-modal">Custom Multi-Modal</mat-option>
                <mat-option value="none">None</mat-option>
            </mat-select>
        </mat-form-field>
        @if (config.stt_provider === "openai") {
            <mat-form-field>
                <mat-label>STT Model Name</mat-label>
                <input matInput [(ngModel)]="config.stt_model_name"
                        (ngModelChange)="onConfigChange({stt_model_name: $event})">
            </mat-form-field>
            <mat-form-field>
                <mat-label>STT Language Code</mat-label>
                <input matInput [(ngModel)]="config.stt_language" placeholder="auto" pattern="([a-z]{2})?"
                        (ngModelChange)="onConfigChange({stt_language: $event})">
            </mat-form-field>
            <mat-form-field>
                <mat-label>Override STT API Key</mat-label>
                <input matInput type="password" [(ngModel)]="config.stt_api_key"
                        (ngModelChange)="onConfigChange({stt_api_key: $event})">
            </mat-form-field>
        }
        @if (config.stt_provider === "google-ai-studio") {
            <mat-form-field>
                <mat-label>STT Model Name</mat-label>
                <input matInput [(ngModel)]="config.stt_model_name"
                        (ngModelChange)="onConfigChange({stt_model_name: $event})">
            </mat-form-field>
            <mat-form-field>
                <mat-label>Override STT API Key</mat-label>
                <input matInput type="password" [(ngModel)]="config.stt_api_key"
                        (ngModelChange)="onConfigChange({stt_api_key: $event})">
            </mat-form-field>
        }
        @if (config.stt_provider === "local-ai-server") {
            <mat-form-field>
                <mat-label>STT Endpoint</mat-label>
                <input matInput [(ngModel)]="config.stt_endpoint"
                        (ngModelChange)="onConfigChange({stt_endpoint: $event})">
            </mat-form-field>
            <mat-form-field>
                <mat-label>STT Language Code</mat-label>
                <input matInput [(ngModel)]="config.stt_language" placeholder="default" pattern="([a-z]{2})?"
                        (ngModelChange)="onConfigChange({stt_language: $event})">
            </mat-form-field>
        }
        @if (config.stt_provider === "custom") {
            <mat-form-field>
                <mat-label>STT Endpoint</mat-label>
                <input matInput [(ngModel)]="config.stt_endpoint"
                        (ngModelChange)="onConfigChange({stt_endpoint: $event})">
            </mat-form-field>
            <mat-form-field>
                <mat-label>STT Model Name</mat-label>
                <input matInput [(ngModel)]="config.stt_model_name"
                        (ngModelChange)="onConfigChange({stt_model_name: $event})">
            </mat-form-field>
            <mat-form-field>
                <mat-label>STT Language Code</mat-label>
                <input matInput [(ngModel)]="config.stt_language" placeholder="default"
                        (ngModelChange)="onConfigChange({stt_language: $event})">
            </mat-form-field>
            <mat-form-field>
                <mat-label>Override STT API Key</mat-label>
                <input matInput type="password" [(ngModel)]="config.stt_api_key"
                        (ngModelChange)="onConfigChange({stt_api_key: $event})">
            </mat-form-field>
        }
        @if (config.stt_provider === "custom-multi-modal") {
            <mat-form-field>
                <mat-label>STT Endpoint</mat-label>
                <input matInput [(ngModel)]="config.stt_endpoint"
                        (ngModelChange)="onConfigChange({stt_endpoint: $event})">
            </mat-form-field>
            <mat-form-field>
                <mat-label>STT Model Name</mat-label>
                <input matInput [(ngModel)]="config.stt_model_name"
                        (ngModelChange)="onConfigChange({stt_model_name: $event})">
            </mat-form-field>
            <mat-form-field>
                <mat-label>Override STT API Key</mat-label>
                <input matInput type="password" [(ngModel)]="config.stt_api_key"
                        (ngModelChange)="onConfigChange({stt_api_key: $event})">
            </mat-form-field>
        }
        @if (config.stt_provider === "none") {
            <p>STT is disabled</p>
        }


        <hr>
        <h3>TTS Settings</h3>
        <mat-form-field>
            <mat-label>TTS Provider</mat-label>
            <mat-select [(ngModel)]="config.tts_provider"
                        (ngModelChange)="onConfigChange({tts_provider: $event})">
                <mat-option value="openai">OpenAI</mat-option>
                <mat-option value="edge-tts">Edge TTS</mat-option>
                <mat-option value="local-ai-server">Local AIServer</mat-option>
                <mat-option value="custom">Custom</mat-option>
                <mat-option value="none">None</mat-option>
            </mat-select>
        </mat-form-field>
        @if (config.tts_provider === "openai") {
            <mat-form-field>
                <mat-label>TTS Model Name</mat-label>
                <input matInput [(ngModel)]="config.tts_model_name"
                        (ngModelChange)="onConfigChange({tts_model_name: $event})">
            </mat-form-field>
            <mat-form-field>
                <mat-label>TTS Voice</mat-label>
                <mat-select [ngModel]="character?.tts_voice || 'nova'"
                            (ngModelChange)="updateTTSVoice($event)">
                    <mat-option value="alloy">Alloy - Neutral, versatile voice</mat-option>
                    <mat-option value="ash">Ash - New voice</mat-option>
                    <mat-option value="ballad">Ballad - New voice</mat-option>
                    <mat-option value="coral">Coral - New voice</mat-option>
                    <mat-option value="echo">Echo - Deeper, experienced voice</mat-option>
                    <mat-option value="fable">Fable - Warm, soft-spoken voice</mat-option>
                    <mat-option value="nova">Nova - Bright, friendly voice</mat-option>
                    <mat-option value="onyx">Onyx - Deep, authoritative voice</mat-option>
                    <mat-option value="sage">Sage - New voice</mat-option>
                    <mat-option value="shimmer">Shimmer - Clear, warm voice</mat-option>
                </mat-select>
            </mat-form-field>
            <mat-form-field>
                <mat-label>Override TTS API Key</mat-label>
                <input matInput type="password" [(ngModel)]="config.tts_api_key"
                        (ngModelChange)="onConfigChange({tts_api_key: $event})">
            </mat-form-field>

            @if (!voiceInstructionSupportedModels.includes(config.tts_model_name)) {
                <mat-form-field>
                    <mat-label>TTS Speed</mat-label>
                    <input matInput [ngModel]="character?.tts_speed || '1,2'"
                            (ngModelChange)="updateTTSSpeed($event)">
                </mat-form-field>
            }
            @if (voiceInstructionSupportedModels.includes(config.tts_model_name)) {
                <mat-hint>Voice instructions: Enter a detailed description of how you want your voice to sound. You can include things such as: accent, emotional range, tone, impressions and speed.<br>
                    Warning: This will increase the cost of each query!</mat-hint>
                <mat-form-field>
                    <mat-label>Voice Tone Instructions</mat-label>
                    <textarea matInput [ngModel]="character?.tts_prompt || ''"
                              (ngModelChange)="updateTTSPrompt($event)"
                              rows="3"></textarea>

                </mat-form-field>
            }
        }
        @if (config.tts_provider === "edge-tts") {
            <mat-form-field>
                <mat-label>TTS Voice</mat-label>
                <input matInput [ngModel]="character?.tts_voice || 'en-US-AvaMultilingualNeural'"
                        (ngModelChange)="updateTTSVoice($event)">
            </mat-form-field>
            <mat-form-field>
                <mat-label>TTS Speed</mat-label>
                <input matInput [ngModel]="character?.tts_speed || '1.2'"
                       (ngModelChange)="updateTTSSpeed($event)">
            </mat-form-field>
        }
        @if (config.tts_provider === "local-ai-server") {
            <mat-form-field>
                <mat-label>TTS Endpoint</mat-label>
                <input matInput [(ngModel)]="config.tts_endpoint"
                        (ngModelChange)="onConfigChange({tts_endpoint: $event})">
            </mat-form-field>
            <mat-form-field>
                <mat-label>TTS Voice</mat-label>
                <input matInput [ngModel]="character?.tts_voice || 'nova'"
                        (ngModelChange)="updateTTSVoice($event)">
            </mat-form-field>
            <mat-form-field>
                <mat-label>TTS Speed</mat-label>
                <input matInput [ngModel]="character?.tts_speed || '1,2'"
                        (ngModelChange)="updateTTSSpeed($event)">
            </mat-form-field>
        }
        @if (config.tts_provider === "custom") {
            <mat-form-field>
                <mat-label>TTS Endpoint</mat-label>
                <input matInput [(ngModel)]="config.tts_endpoint"
                        (ngModelChange)="onConfigChange({tts_endpoint: $event})">
            </mat-form-field>
            <mat-form-field>
                <mat-label>TTS Model Name</mat-label>
                <input matInput [(ngModel)]="config.tts_model_name"
                        (ngModelChange)="onConfigChange({tts_model_name: $event})">
            </mat-form-field>
            <mat-form-field>
                <mat-label>TTS Voice</mat-label>
                <input matInput [ngModel]="character?.tts_voice || 'nova'"
                        (ngModelChange)="updateTTSVoice($event)">
            </mat-form-field>
            <mat-form-field>
                <mat-label>TTS Speed</mat-label>
                <input matInput [ngModel]="character?.tts_speed || '1,2'"
                        (ngModelChange)="updateTTSSpeed($event)">
            </mat-form-field>
            <mat-form-field>
                <mat-label>Override TTS API Key</mat-label>
                <input matInput type="password" [(ngModel)]="config.tts_api_key"
                        (ngModelChange)="onConfigChange({tts_api_key: $event})">
            </mat-form-field>
        }
        @if (config.tts_provider === "none") {
            <p>TTS is disabled</p>
        }

        <hr>
        <h3>Vision Settings</h3>
        <mat-form-field>
            <mat-label>Vision Provider</mat-label>
            <mat-select [(ngModel)]="config.vision_provider"
                        (ngModelChange)="onConfigChange({vision_provider: $event, vision_var: $event !== 'none'})">
                <mat-option value="openai">OpenAI</mat-option>
                <mat-option value="google-ai-studio">Google AI Studio</mat-option>
                <mat-option value="custom">Custom</mat-option>
                <mat-option value="none">None</mat-option>
            </mat-select>
        </mat-form-field>

        @if (config.vision_provider && config.vision_provider !== 'none') {
            @if (config.vision_provider === "openai") {
                <mat-form-field>
                    <mat-label>Vision Model Name</mat-label>
                    <input matInput [(ngModel)]="config.vision_model_name"
                            (ngModelChange)="onConfigChange({vision_model_name: $event})">
                </mat-form-field>
                <mat-form-field>
                    <mat-label>Override Vision API Key</mat-label>
                    <input matInput type="password" [(ngModel)]="config.vision_api_key"
                            (ngModelChange)="onConfigChange({vision_api_key: $event})">
                </mat-form-field>
            }

            @if (config.vision_provider === "google-ai-studio") {
                <mat-form-field>
                    <mat-label>Vision Model Name</mat-label>
                    <input matInput [(ngModel)]="config.vision_model_name"
                            (ngModelChange)="onConfigChange({vision_model_name: $event})">
                </mat-form-field>
                <mat-form-field>
                    <mat-label>Override Vision API Key</mat-label>
                    <input matInput type="password" [(ngModel)]="config.vision_api_key"
                            (ngModelChange)="onConfigChange({vision_api_key: $event})">
                </mat-form-field>
            }

            @if (config.vision_provider === "custom") {
                <mat-form-field>
                    <mat-label>Vision Endpoint</mat-label>
                    <input matInput [(ngModel)]="config.vision_endpoint"
                            (ngModelChange)="onConfigChange({vision_endpoint: $event})">
                </mat-form-field>
                <mat-form-field>
                    <mat-label>Vision Model Name</mat-label>
                    <input matInput [(ngModel)]="config.vision_model_name"
                            (ngModelChange)="onConfigChange({vision_model_name: $event})">
                </mat-form-field>
                <mat-form-field>
                    <mat-label>Override Vision API Key</mat-label>
                    <input matInput type="password" [(ngModel)]="config.vision_api_key"
                            (ngModelChange)="onConfigChange({vision_api_key: $event})">
                </mat-form-field>
            }
        }
        @if (config.vision_provider === "none") {
            <p>Vision is disabled</p>
        }
        @if (config && (config.commander_name || config.api_key)) {
            <h3>Autostart</h3>
            <mat-slide-toggle [(ngModel)]="config.cn_autostart"
                    (ngModelChange)="onConfigChange({cn_autostart: $event})">
                    Autostart assistant on application start
            </mat-slide-toggle>
        }
        <div class="character-buttons">
            <button mat-raised-button color="warn"                
                    (click)="bugReport()"
                    
                    [matTooltip]="'Report a Bug directly to covas team.'">
                <mat-icon>bug_report</mat-icon> Report a bug 
            </button>
        </div>

        
        @if (system?.os === 'Linux') {
            <h3>Linux Settings</h3>
            <p>Learn more about this setup <a target="_blank" rel="noopener noreferrer"
                                                href="https://ratherrude.github.io/Elite-Dangerous-AI-Integration/advanced/linux/">here.</a>
            </p>
            <mat-form-field>
                <mat-label>ED AppData Path</mat-label>
                <input matInput [(ngModel)]="config.ed_appdata_path"
                        (ngModelChange)="onConfigChange({ed_appdata_path: $event})">
            </mat-form-field>
            <mat-form-field>
                <mat-label>ED Journal Path</mat-label>
                <input matInput [(ngModel)]="config.ed_journal_path"
                        (ngModelChange)="onConfigChange({ed_journal_path: $event})">
            </mat-form-field>
        }
    }
</div>